# MP4 → MP3 Converter

MP4 ファイルをドラッグ＆ドロップで MP3 に変換する GUI アプリケーションです。
数時間に及ぶ長時間録画にも対応しています。

## 画面構成

```
┌──────────────────────────────────────────┐
│  ここに MP4 ファイルをドラッグ＆ドロップ │  ← ドロップゾーン
├──────────────────────────────────────────┤
│  出力先: [入力ファイルと同じフォルダ  ] │  ← 出力先選択
│  品質: ○128  ●192  ○256  ○320 kbps     │  ← ビットレート選択
├──────────────────────────────────────────┤
│  ファイル名              │  状態          │
│  recording_01.mp4        │  完了 ✓        │  ← ファイルキュー
│  recording_02.mp4        │  変換中…       │
│  recording_03.mp4        │  待機中        │
├──────────────────────────────────────────┤
│  ████████████░░░░░░░░░░░░  62%            │  ← プログレスバー
│  recording_02.mp4  01:14:32 / 02:03:00  │  ← 経過時間 / 総時間
├──────────────────────────────────────────┤
│          [ 変換開始 ]  [ キャンセル ]    │
└──────────────────────────────────────────┘
```

## 必要環境

| ソフトウェア | バージョン | 入手先 |
|---|---|---|
| Python | 3.12 以上 | https://www.python.org/ |
| ffmpeg | 任意 | https://www.gyan.dev/ffmpeg/builds/ |
| tkinterdnd2 | 0.4.0 以上 | pip にて自動インストール |

> **ffmpeg は PATH が通っている必要があります。**
> `ffmpeg -version` がコマンドプロンプトで通れば OK です。

## セットアップ

```powershell
pip install -r requirements.txt
```

## 起動方法

**バッチファイル（推奨）**

```powershell
# PowerShell の場合（.\ が必要）
.\run.bat
```

```bat
rem コマンドプロンプトの場合
run.bat
```

`run.bat` は以下を自動実行します。
- `py -3` → `python` の順で Python 実行環境を検出
- `python -m pip install -r requirements.txt` で依存を確認/導入
- 失敗時はエラーメッセージを表示して停止

**直接実行**

```powershell
python converter.py
```

> PowerShell では `.\run.bat` のように `.\` を付けて実行してください。

## 使い方

1. アプリを起動する
2. MP4 ファイルをドロップゾーンにドラッグ＆ドロップする（複数可）
3. 必要に応じて出力先フォルダとビットレートを設定する
4. **変換開始** ボタンを押す
5. 完了するとファイルリストに「完了 ✓」と表示される

## 機能

| 機能 | 説明 |
|---|---|
| 複数ファイル対応 | 複数の MP4 を一括でドロップしてまとめて変換 |
| リアルタイム進捗 | `HH:MM:SS / HH:MM:SS` で経過時間と総時間を表示 |
| 出力先指定 | デフォルトは入力ファイルと同じフォルダ。任意フォルダへ変更可能 |
| ビットレート選択 | 128 / 192 / 256 / 320 kbps から選択（デフォルト: 192） |
| キャンセル | 変換中でも即座に停止可能 |
| エラー表示 | 失敗したファイルをリストで色分け表示。再実行も可能 |
| 重複スキップ | 同じファイルを二重にドロップしても重複追加しない |

## 出力仕様

| 項目 | 値 |
|---|---|
| コーデック | MP3 (libmp3lame) |
| サンプリングレート | 44,100 Hz |
| ビットレート | 選択値（128 / 192 / 256 / 320 kbps） |
| ファイル名 | 入力ファイルの拡張子を `.mp3` に変更 |
| 同名ファイル | 上書き（`-y` オプション） |

## ファイル構成

```
mp4-to-mp3/
├── converter.py      # メインプログラム
├── requirements.txt  # Python 依存パッケージ
├── run.bat           # 起動用バッチ（Python検出・依存インストール付き）
└── README.md         # このファイル
```

## トラブルシューティング

**`run.bat` 実行時に「内部コマンドまたは外部コマンドとして認識されていません」が出る**
- 以前の `run.bat` が文字コード不整合で壊れていた可能性があります。
- 最新版の `run.bat` に更新後、再実行してください。

**ドラッグ＆ドロップが反応しない**
`tkinterdnd2` が正しくインストールされているか確認します。
```powershell
pip install tkinterdnd2
```

**変換後に音声がない**
入力の MP4 に音声トラックが含まれていない可能性があります。
`ffprobe <ファイル名>` でストリーム情報を確認してください。

